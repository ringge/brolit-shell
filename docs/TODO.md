# TODO List

## For release 3.2

### Know Bugs

- [ ] When restore a backup and change project_name or/and project_domain the script fails:
        - If the main domain detected is a root-domain like mydomain.com the "search and replace" 
          will replace https://www.mydomain.com by https://www.test.mydomain.com
        - If decide to generate new certificate on root-domain, it fails to generate nginx config
- [ ] LetsEncrypt: when delete a certificate, nginx config fails.
- [ ] Cloudflare: if migrate a site with certificates generated by python3-certbot-cloudflare, the certbot will fail.
      Maybe we could ask if it has the proxy enable via Cloudflare API and disable before generate new certificates.

### Need improvements

- [ ] Core: need to check if select domain is a root domain or www domain, and ask if the user want to create a redirection.
- [ ] Cloudflare: Creating a new root domain project, will try to add an A record but need to create a CNAME for www too.
- [ ] Cloudflare-Certbot: Change proxy mode with Cloudflare API when create a certificate with Cloudflare.
        Also, if you use www, it should ask you if you want to use the root domain too.
- [ ] Nginx-LetsEncrypt: regenerate nginx server configuration projects fails after running certbot.
- [ ] Nginx-LetsEncrypt: When copy or generate a new nginx server configuration need to check certificates.
- [ ] LetsEncrypt: need a better way to re-install a certificate after a website migration.
- [ ] Project: on project delete, if the script can't find the user, maybe it will be better list all mysql users with database permision (before database deletion).
- [ ] WordPress: WP-CLI should not be required if server type != webserver.
- [ ] Notifications: Email HTML breaks sometimes.
- [ ] Backups: When restore or create a new project and the db_user already exists, we need to ask what todo (new user or continue?).

### Need more testing

- [ ] Core: Let configure temp. backup directory.
- [ ] Nginx: Globals configs support.
- [ ] PHP: Option to enable or disable OpCache.

### In Progress

- [ ] Core: Prevent execute the script more than once at a time (maybe a .lock file?).
- [ ] Core: Stop netdata alerts when a backup or virus analysis is started.
- [ ] Core: Generate project config file (/etc/brolit/domain_conf.json).
- [ ] Core: Flags should receive a json file to deploy or restore a new project.
- [ ] Core: On project creation/restore need to ask first the project state, then project domain.
        If project state != prod and subdomains is not containing the stage, need to suggest one.
        Example: test.multiplacas.broobe.hosting OK
        Example 2: multiplacas.broobe.hosting X (OK only if prod).
- [ ] Restore-project: big refactor.
- [ ] Restore-database: granting privileges to user fails, database_name is empty.

## For release 3.3

- [ ] Core: Implementation of brolit_project.js (to read and deploy).
- [ ] Core: Extend ufw support.
- [ ] Core: Extend fail2ban support.
- [ ] Core: composer support.
- [ ] Core: node.js support.
- [ ] Core: Docker support (deploy, backup, restore, delete, list containers, status).
        https://github.com/urre/wordpress-nginx-docker-compose
        https://serverfault.com/questions/1009841/backup-of-dockerized-wordpress
- [ ] Core: Docker compose support.
- [ ] Core: Better structure of deleted projects on dropbox.
- [ ] Core: Add an option to backup all and prepare VPS to be offline/deleted (add a VPS offline structure on dropbox).
- [ ] Core: create a way to check if nginx, php, and mysql are configured with the script recommendations.
- [ ] Core: make new standard directory structure for projects "${PROJECTS_PATH}/${ROOT_DOMAIN}/${SUBDOMAIN}/public". ?
      Logs could be stored on "${PROJECTS_PATH}/${ROOT_DOMAIN}/${SUBDOMAIN}/log"
- [ ] Core: maybe with could ask for database user nomenclature. Today is "PROJECTNAME_user" and it could be "PROJECTNAME_PROJECTSTATE_user".
- [ ] Backups: Refactor for backup/restore: 5 options (server_config, site_config, site, database and project).
- [ ] Backups: Backup retention configuration from brolit_conf.json
- [ ] Restore: Refactor function restore_config_files_from_dropbox.
- [ ] Nginx: Multidomain support for nginx.
- [ ] MySQL: Rename database (with and without WP).
- [ ] PHP: php_reconfigure refactor (replace strings instead of replace entired config files).
- [ ] Nginx: Add IPv6 support: https://geekflare.com/es/enable-ipv6-nginx-apache/
- [ ] Nginx: Better nginx config. 
        Ref https://www.digitalocean.com/community/tools/nginx

## For release 3.4

- [ ] Core: Podman support.
- [ ] Core: Git deployment support.
- [ ] Core: Resolve small "TODOs" comments on the project.
- [ ] Core: Add support to create projects with a database on different server.
        https://www.digitalocean.com/community/tutorials/automating-the-deployment-of-a-scalable-wordpress-site
        https://spinupwp.com/scaling-wordpress-dedicated-database-server/
- [ ] Notifications: After install a new project (with credentials info).
- [ ] Backups: On backup failure, the email must show what files fails and what files are correct backuped.
- [ ] Backups: Implement on restore_from_backup easy way to restore all sites.
- [ ] Scheduled options: backups, malware scans, image optimizations and wp actions (core and plugins updates, checksum and wp re-installation).
- [ ] Refactor of RESTORE_FROM_SOURCE and complete server config restore.
- [ ] Nginx: New option to put website on maintenance (maybe rename index.html/php and create a new HTML).
- [ ] LetsEncrypt: Add more options of certificates creation (certonly and return the path).
- [ ] Wordpress: Rollback plugins and core updates (wpcli_rollback_plugin_version)
- [ ] SFTP: Option to create a user jail on sftp_create_user.
        Important:https://www.electricmonk.nl/log/2015/07/13/ssh-chrootdirectory-sftponly-not-working-fixed/
- [ ] Core: Add react-project support:
        https://www.digitalocean.com/community/tutorials/how-to-deploy-a-react-application-with-nginx-on-ubuntu-20-04
- [ ] Security: Option to auto-install security updates on Ubuntu: 
        https://help.ubuntu.com/lts/serverguide/automatic-updates.html

## For release 3.5

- [ ] WordPress: Fallback for replace strings on wp database (if wp-cli fails, use old script version).
- [ ] Wordpress: When restore or create a project on PROD state, ask if want to run "wpcli_run_startup_script"
- [ ] Installers: Refactor of WORDPRESS_INSTALLER - COPY_FROM_PROJECT
        The idea is that you could create/copy/delete/update different kind of projects (WP, Laravel, React, Composer, Empty)
        Maybe add this for Laravel: https://gitlab.com/broobe/laravel-boilerplate/-/tree/master
        Important: if create a project with stage different than prod, block search engine indexation
- [ ] Installers: COPY_FROM_PROJECT option to exclude uploads directory
        rsync -ax --exclude [relative path to directory to exclude] /path/from /path/to
- [ ] Hetzner cloud cli support: https://github.com/hetznercloud/cli
- [ ] Network: implements hetzner network configuration.
      https://docs.hetzner.com/cloud/networks/server-configuration/

## For release 3.6

- [ ] Backups: Support for dailys, weeklys y monthlys backups.
- [ ] Backups: Directory Blacklist with whiptail (for backup configuration).
- [ ] Server Optimization: Complete the pdf optimization process.
- [ ] MySQL: Optimization script.
- [ ] Woocommerce support: https://github.com/woocommerce/woocommerce/wiki/WC-CLI-Commands
- [ ] Buddypress support: https://github.com/buddypress/wp-cli-buddypress
- [ ] IT Utils: Control of mounted partitions or directories.
- [ ] IT Utils: Better malware detection with https://github.com/rfxn/linux-malware-detect
- [ ] Addon: Fileover support with hetzner? https://community.hetzner.com/tutorials/failover-script

## For release 3.7

- [ ] Backups: Expand Duplicity support with a restore option.
- [ ] Backups: Rsync support on mounted device or with SSH config.
- [ ] PHP: Option to change php version on installed site.
        https://easyengine.io/blog/easyengine-v4-0-15-released/
- [ ] Installers: Option to select netdata metrics to be reported.
        https://docs.netdata.cloud/health/notifications/discord/
- [ ] Installers: Mailcow installer and backup.
- [ ] Include network (lan and internet) tests with iperf and speedtest-cli.
- [ ] Support for rclone: https://github.com/rclone/rclone
      Add support to others storage service (Google Drive, SFTP, etc)

## For release 4.0

- [ ] Teleport support.
- [ ] HTTP/2 Monitor Dashboard.
- [ ] Uptime Kuma support: 
        https://github.com/louislam/uptime-kuma
- [ ] WordPress: WP Network support (nginx config, and wp-cli commands).
- [ ] Netdata notifications Discord support.
- [ ] Support for borgmatic?: https://github.com/witten/borgmatic
- [ ] Core: Accept command via Telegram: https://github.com/topkecleon/telegram-bot-bash
- [ ] Nginx: bad bot blocker.
      https://github.com/mitchellkrogza/nginx-ultimate-bad-bot-blocker